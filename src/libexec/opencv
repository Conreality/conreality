#!/usr/bin/env python2.7
import numpy
import cv2
from signal import *
from sys import argv, exit
from syslog import *

def handle_signal(signum, stack_frame):
  syslog(LOG_INFO, "Received a signal (%d), terminating..." % signum)
  exit(0x80 + signum)

def main(argv):
  openlog("conreality", logoption=LOG_PID|LOG_CONS|LOG_NDELAY, facility=LOG_DAEMON)
  setlogmask(LOG_UPTO(LOG_DEBUG))
  signal(SIGHUP, handle_signal)
  signal(SIGINT, handle_signal)
  signal(SIGPIPE, handle_signal)
  signal(SIGTERM, handle_signal)

  camera = cv2.VideoCapture(0)

  while True:
    success, frame = camera.read()
    if not success:
      syslog(LOG_ERR, "Failed to read frame from video capture device; terminating...")
      break
    pause() # TODO

  camera.release()

  closelog()

if __name__ == '__main__':
  main(argv)
